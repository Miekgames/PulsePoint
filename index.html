<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PulsePoint Card Game</title>
  <style>
    body { margin:0; font-family:sans-serif; background:#181c2b; color:#fff; }
    #loading { position:fixed; top:0; left:0; width:100vw; height:100vh; background:#0e1120; display:flex; align-items:center; justify-content:center; flex-direction:column; z-index:10; }
    #main, #battle, #trade, #collection, #menu { display:none; }
    .btn { padding:12px 24px; margin:8px; background:#222e50; color:#fff; border:none; border-radius:4px; font-size:1rem; cursor:pointer; }
    .btn:hover { background:#3a4b7a; }
    .card { background:#222e50; border-radius:8px; padding:18px; margin:10px; display:inline-block; box-shadow:0 2px 8px #0003; min-width:200px;}
    .card.selected { border:2px solid #f6b93b; }
    .flex { display:flex; flex-wrap:wrap; gap:10px; }
    .hidden {display:none;}
    #battle-log { max-height:120px; overflow:auto; background:#15172a; padding:8px; border-radius:8px; margin-top:10px; font-size:0.95em;}
  </style>
</head>
<body>
  <div id="loading">
    <h1>PulsePoint</h1>
    <p>Loading game assets...</p>
    <div id="loaderbar" style="background:#333;width:300px;height:12px;border-radius:8px;overflow:hidden;">
      <div id="loaderfill" style="background:#f6b93b;width:0;height:100%;"></div>
    </div>
    <p style="color:#aaa;margin-top:10px;">A strategy card game by Miekgames</p>
  </div>
  
  <div id="main">
    <div id="menu">
      <h1>PulsePoint</h1>
      <button class="btn" onclick="showCollection()">My Collection</button>
      <button class="btn" onclick="showBattle()">Battle</button>
      <button class="btn" onclick="showTrade()">Trade</button>
      <button class="btn" onclick="resetGame()">Reset Game</button>
    </div>
    <div id="collection">
      <h2>My Pulse Collection</h2>
      <div id="my-cards" class="flex"></div>
      <button class="btn" onclick="showMenu()">Back</button>
    </div>
    <div id="battle">
      <h2>Battle Arena</h2>
      <div>
        <strong>Your Pulse:</strong>
        <span id="your-battle-card"></span>
        <button class="btn" onclick="pickBattleCard()">Change</button>
      </div>
      <div>
        <strong>Opponent Pulse:</strong>
        <span id="opp-battle-card"></span>
        <button class="btn" onclick="startBattle()">New Opponent</button>
      </div>
      <div id="battle-controls"></div>
      <div id="battle-log"></div>
      <button class="btn" onclick="showMenu()">Back</button>
    </div>
    <div id="trade">
      <h2>Trade Pulse</h2>
      <div class="flex">
        <div>
          <h4>Your Cards</h4>
          <div id="your-trade-cards"></div>
        </div>
        <div>
          <h4>Trade Market</h4>
          <div id="trade-market-cards"></div>
        </div>
      </div>
      <button class="btn" onclick="showMenu()">Back</button>
    </div>
  </div>
  <script>
    // --- Loader ---
    let LOADING_STEPS = 4;
    let loadedSteps = 0;
    function updateLoader() {
      loadedSteps++;
      document.getElementById("loaderfill").style.width = (loadedSteps/LOADING_STEPS*100)+"%";
      if (loadedSteps>=LOADING_STEPS) {
        setTimeout(()=> {
          document.getElementById("loading").style.display="none";
          document.getElementById("main").style.display="block";
          showMenu();
        }, 600);
      }
    }
    // --- Card Data ---
    const pulseNames = [
      "Voltkit", "Aquaff", "Pyron", "Terrapod", "Frostle", "Lumina", "Gloomvine", "Spargle", "Ignix", "Toxine", 
      "Vibrune", "Quillace", "Barkoon", "Singeon", "Ferrox", "Bloomble", "Drizzle", "Shadowl", "Shellix", "Gustine",
      "Buzzlet", "Pebblit", "Blazic", "Glacielle", "Thundra", "Spindle", "Duskrill", "Gloworm", "Petalyn", "Crestal",
      "Shadewisp", "Scorchy", "Funglow", "Twiluna", "Mossaur", "Brineer", "Pyrite", "Dawnbud", "Frostip", "Tideetle",
      "Emberfin", "Tempest", "Verdra", "Spikoon", "Mistral", "Chillisk", "Gloomgle", "Luster", "Sandrip", "Stormule"
    ];
    function randomFrom(arr) { return arr[Math.floor(Math.random()*arr.length)]; }
    function createPulse(id) {
      // For variety, stats are pseudo random based on id
      let baseHealth = 45 + ((id*7)%40);
      let baseAttack = 15 + ((id*11)%25);
      let type = ["Electric","Water","Fire","Earth","Ice","Light","Dark","Plant","Poison","Air"][id%10];
      let attacks = [
        {name: type+" Burst", power: 9+id%5},
        {name: ["Quick Jab","Power Slam","Pulse Shot","Echo Strike","Lifedrain"][id%5], power: 5+(id*3)%8}
      ];
      return {
        id, name:pulseNames[id], type,
        health: baseHealth,
        attack: baseAttack,
        attacks,
        level:1, xp:0
      }
    }
    const ALL_PULSES = [];
    for(let i=0;i<50;i++) ALL_PULSES.push(createPulse(i));
    updateLoader();
    // --- Save/Load ---
    function saveGame() { localStorage.setItem("pulse_save", JSON.stringify({myPulses,tradedPulses})); }
    function loadGame() {
      let data = localStorage.getItem("pulse_save");
      if (data) {
        let obj = JSON.parse(data);
        myPulses = obj.myPulses||[];
        tradedPulses = obj.tradedPulses||[];
      } else {
        // Starter: 5 random
        myPulses = [];
        let ids = [];
        while (ids.length<5) { let n=Math.floor(Math.random()*50); if (!ids.includes(n)) ids.push(n);}
        ids.forEach(i=>myPulses.push({...ALL_PULSES[i]}));
        tradedPulses = [];
        // Market: 5 random
        let tids = [];
        while (tids.length<5) { let n=Math.floor(Math.random()*50); if (!ids.includes(n)&&!tids.includes(n)) tids.push(n);}
        tids.forEach(i=>tradedPulses.push({...ALL_PULSES[i]}));
        saveGame();
      }
    }
    let myPulses=[], tradedPulses=[];
    loadGame(); updateLoader();

    // --- Menu Handling ---
    function showMenu() {
      hideAll(); document.getElementById("menu").style.display="block";
    }
    function showCollection() {
      hideAll(); document.getElementById("collection").style.display="block"; renderMyCards();
    }
    function showBattle() {
      hideAll(); document.getElementById("battle").style.display="block"; setupBattle();
    }
    function showTrade() {
      hideAll(); document.getElementById("trade").style.display="block"; renderTrade();
    }
    function hideAll() {
      ["menu","collection","battle","trade"].forEach(id=>document.getElementById(id).style.display="none");
    }
    function resetGame() {
      if(confirm("Reset your PulsePoint progress?")) {
        localStorage.removeItem("pulse_save");
        loadGame();
        alert("Progress reset!");
        showMenu();
      }
    }
    // --- Render Collection ---
    function renderMyCards() {
      let c = document.getElementById("my-cards"); c.innerHTML="";
      myPulses.forEach((p,i)=>{
        let div = document.createElement("div");
        div.className="card";
        div.innerHTML = `
          <b>${p.name}</b> <span style="float:right;font-size:.93em;">Lv.${p.level}</span><br>
          <i>${p.type}</i><br>
          HP: ${p.health} | ATK: ${p.attack}<br>
          <span style="font-size:.93em;">
            1. ${p.attacks[0].name} (${p.attacks[0].power})<br>
            2. ${p.attacks[1].name} (${p.attacks[1].power})<br>
          </span>
          XP: ${p.xp}/${xpForNextLevel(p.level)}
        `;
        c.appendChild(div);
      });
    }
    // --- Battle System ---
    let battle = { your:null, opp:null, yourHP:0, oppHP:0, turn:0, inProgress:false };
    function setupBattle() {
      if (!battle.your) pickBattleCard();
      if (!battle.opp) startBattle();
      updateBattleUI();
    }
    function pickBattleCard() {
      let names = myPulses.map((p,i)=>`${i+1}. ${p.name} Lv.${p.level}`).join("\n");
      let idx = prompt("Pick your Pulse for battle (1-"+myPulses.length+"):");
      idx = parseInt(idx)-1;
      if (myPulses[idx]) {
        battle.your = myPulses[idx];
        battle.yourHP = battle.your.health + 4*battle.your.level;
        updateBattleUI();
      }
    }
    function startBattle() {
      let opp = {...randomFrom(ALL_PULSES)};
      opp.level = Math.max(1, Math.floor(Math.random()*battle.your.level+1));
      opp.xp = 0;
      battle.opp = opp;
      battle.oppHP = opp.health + 4*opp.level;
      battle.turn = 0;
      battle.inProgress = true;
      logBattle(`A wild ${opp.name} (Lv.${opp.level}) appears!`);
      updateBattleUI();
    }
    function updateBattleUI() {
      document.getElementById("your-battle-card").innerHTML = battle.your?`${battle.your.name} (Lv.${battle.your.level}) HP:${battle.yourHP}`:"[Pick]";
      document.getElementById("opp-battle-card").innerHTML = battle.opp?`${battle.opp.name} (Lv.${battle.opp.level}) HP:${battle.oppHP}`:"[Start]";
      let controls = "";
      if (battle.inProgress) {
        controls += `<button class="btn" onclick="battleAttack(0)">${battle.your.attacks[0].name}</button>`;
        controls += `<button class="btn" onclick="battleAttack(1)">${battle.your.attacks[1].name}</button>`;
      }
      document.getElementById("battle-controls").innerHTML = controls;
    }
    function logBattle(txt) {
      let log = document.getElementById("battle-log");
      log.innerHTML += txt+"<br>";
      log.scrollTop = log.scrollHeight;
    }
    function battleAttack(idx) {
      if (!battle.inProgress) return;
      let dmg = battle.your.attack + battle.your.attacks[idx].power + Math.floor(battle.your.level/2);
      battle.oppHP -= dmg;
      logBattle(`You used ${battle.your.attacks[idx].name}! (${dmg} dmg)`);
      if (battle.oppHP<=0) {
        logBattle(`You defeated ${battle.opp.name}! +${10+2*battle.opp.level} XP`);
        addXP(battle.your, 10+2*battle.opp.level);
        battle.inProgress=false;
        updateBattleUI();
        return;
      }
      // Opponent turn
      setTimeout(()=>{
        let odx = Math.random()>0.5?0:1;
        let odmg = battle.opp.attack + battle.opp.attacks[odx].power + Math.floor(battle.opp.level/2);
        battle.yourHP -= odmg;
        logBattle(`${battle.opp.name} used ${battle.opp.attacks[odx].name}! (${odmg} dmg)`);
        if (battle.yourHP<=0) {
          logBattle(`Your ${battle.your.name} fainted!`);
          battle.inProgress=false;
        }
        updateBattleUI();
      }, 900);
      updateBattleUI();
    }
    function addXP(pulse, amt) {
      pulse.xp += amt;
      while (pulse.xp >= xpForNextLevel(pulse.level)) {
        pulse.xp -= xpForNextLevel(pulse.level);
        pulse.level++;
        pulse.health += 7; pulse.attack += 2;
        logBattle(`${pulse.name} leveled up! Now Lv.${pulse.level}`);
      }
      saveGame();
      renderMyCards();
    }
    function xpForNextLevel(lv) { return 16+lv*8; }
    // --- Trading System ---
    function renderTrade() {
      let your = document.getElementById("your-trade-cards");
      let market = document.getElementById("trade-market-cards");
      your.innerHTML=""; market.innerHTML="";
      myPulses.forEach((p,i)=>{
        let div = document.createElement("div");
        div.className="card";
        div.innerHTML = `<b>${p.name}</b> Lv.${p.level}<br>Type:${p.type}<br><button class="btn" onclick="offerTrade(${i})">Offer</button>`;
        your.appendChild(div);
      });
      tradedPulses.forEach((p,i)=>{
        let div = document.createElement("div");
        div.className="card";
        div.innerHTML = `<b>${p.name}</b> Lv.${p.level}<br>Type:${p.type}<br><button class="btn" onclick="tradeFor(${i})">Trade</button>`;
        market.appendChild(div);
      });
    }
    function offerTrade(idx) {
      // Remove from myPulses, add to market
      if (myPulses.length<=1) { alert("You must keep at least 1 Pulse."); return; }
      tradedPulses.push(myPulses[idx]);
      myPulses.splice(idx,1);
      saveGame(); renderTrade();
    }
    function tradeFor(idx) {
      // Remove from market, add to myPulses
      if (myPulses.length>=10) { alert("Max 10 Pulses in collection."); return; }
      myPulses.push(tradedPulses[idx]);
      tradedPulses.splice(idx,1);
      saveGame(); renderTrade();
    }
    updateLoader();
    // --- End ---
    updateLoader();
  </script>
</body>
</html>
